---
title: "Remote Sensing Data"
author: "Laura Graham"
date: "30 November 2015"
output: 
  html_document: 
    fig_caption: yes
    theme: journal
---

```{r, echo=FALSE, message=FALSE}
# load required packages
require(dplyr)
require(ggplot2)
require(cowplot)
# function to attach the site name 
fnLocation <- function(df) {
    factor(df$Id, labels=c("SANA", "LLAV", "MASE", "MAIN"))
}

# load RS data files
evi.dat <- do.call("rbind", lapply(list.files("../data/rs-data/", pattern="EVI", full.names = TRUE), 
                               function(x) read.csv(x, stringsAsFactors = FALSE))) 

evi <- filter(evi.dat, complete.cases(evi.dat)==TRUE) %>%
    mutate(site=fnLocation(.),
           date=as.Date(gsub("_", "-", substr(system.index, 13, 22))),
           measure="Mean EVI",
           value=mean) %>%
    select(site, date, measure, value) 

evi.na <- filter(evi.dat, BUFF_DIST!="") %>%
    filter(complete.cases(.)==FALSE)

ndvi.dat <- do.call("rbind", lapply(list.files("../data/rs-data/", pattern="NDVI", full.names = TRUE), 
                                function(x) read.csv(x, stringsAsFactors = FALSE))) 

ndvi <- filter(ndvi.dat, complete.cases(ndvi.dat)==TRUE) %>%
    mutate(site=fnLocation(.),
           date=as.Date(gsub("_", "-", substr(system.index, 13, 22))),
           measure="Mean NDVI",
           value=mean) %>%
    select(site, date, measure, value) # 765 missing values (48%)

ndvi.na <- filter(ndvi.dat, BUFF_DIST!="") %>%
    filter(complete.cases(.)==FALSE)

temp <- do.call("rbind", lapply(list.files("../data/rs-data/", pattern="temp", ignore.case=TRUE, full.names = TRUE), 
                                function(x) read.csv(x, stringsAsFactors = FALSE))) %>%
    filter(complete.cases(.)==TRUE) %>%
    mutate(site=fnLocation(.),
           date=as.Date(paste(substr(system.index, 12, 15), 
                              substr(system.index, 16, 17),
                              substr(system.index, 18, 19), sep="-")),
           measure="Mean temperature",
           value=mean) %>%
    select(site, date, measure, value)

prec <- read.csv("../data/rs-data/k_guay_TRMM.csv", stringsAsFactors = FALSE) %>%
    filter(complete.cases(.)==TRUE) %>%
    mutate(site=fnLocation(.), measure="Total precipitation", value=sum.precipitation..mm., date=as.character(year)) %>%
    select(site, date, measure, value)

veg.data <- rbind(evi, ndvi)
```

We have the following remotely sensed data:

**NDVI/EVI**
    
* 8-day means
* Value for each of the four sites
* Lots of missing values (`r round((nrow(evi.na)/(nrow(evi)+nrow(evi.na)))*100)`%for EVI and `r round((nrow(ndvi.na)/(nrow(ndvi)+nrow(ndvi.na)))*100)`%for NDVI)
    
**Temperature**

* 6-hour means
* Complete data
* One value for all sites

**Precipitation**

* Annual total
* One value for all sites
* NB Having had a look into TRMM where they got the data from, I think that we can probably get this data at a finer temporal resolution if we ask
* Also, was 2006 a particularly dry year, or is that a data error? See plot below. 

They also provided us with a dataset that gives the primary landcover, but this gives us less information than we already have about the habitat at each site. 

The data look as follows: 

```{r, echo=FALSE}
ggplot(veg.data, aes(x=date, y=value, colour=site)) +
    geom_line() +
    facet_wrap(~measure, ncol=1)

ggplot(temp, aes(x=date, y=value)) +
    geom_line() +
    facet_wrap(~measure)

ggplot(prec, aes(x=date, y=value)) + 
    geom_bar(stat="identity") + 
    facet_wrap(~measure)
    
```


    